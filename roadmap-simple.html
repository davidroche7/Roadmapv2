<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Team Roadmap</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.4.3/mermaid.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; }
        textarea { width: 100%; height: 300px; font-family: monospace; padding: 10px; }
        button { padding: 8px 12px; background-color: #4CAF50; color: white; border: none; 
                border-radius: 4px; cursor: pointer; margin: 10px 5px 10px 0; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 8px; text-align: left; border: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        .output { margin-top: 20px; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Architecture Team Roadmap</h1>
        
        <h2>Enter Roadmap Data</h2>
        <textarea id="jsonInput" placeholder="Enter your JSON data here..."></textarea>
        
        <div>
            <button onclick="loadSample()">Load Sample Data</button>
            <button onclick="generateRoadmap()">Generate Roadmap</button>
            <button onclick="saveData()">Save as JSON</button>
            <button onclick="exportHtml()">Export as HTML</button>
            <button onclick="exportConfluence()">Export for Confluence</button>
        </div>
        
        <div id="output" class="output"></div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ startOnLoad: true });
        
        // Sample data
        const sampleData = [
            {
                "project_name": "Work object 1",
                "architect": "Stanley",
                "type": "Product roadmap",
                "status": "In Progress",
                "start_date": "2025-02-21",
                "end_date": "2025-09-23"
            },
            {
                "project_name": "Feature X Redesign",
                "architect": "Alan",
                "type": "Feature",
                "status": "Complete",
                "start_date": "2025-01-01",
                "end_date": "2025-03-01"
            },
            {
                "project_name": "Cloud Migration",
                "architect": "David",
                "type": "Infrastructure",
                "status": "Planned",
                "start_date": "2025-04-01",
                "end_date": "2025-07-15"
            }
        ];
        
        // Load sample data
        function loadSample() {
            document.getElementById('jsonInput').value = JSON.stringify(sampleData, null, 2);
        }
        
        // Save JSON data
        function saveData() {
            try {
                const jsonData = document.getElementById('jsonInput').value;
                // Parse to check validity
                JSON.parse(jsonData);
                
                const blob = new Blob([jsonData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'roadmap-data.json';
                a.click();
                URL.revokeObjectURL(url);
            } catch (error) {
                alert('Error saving data: ' + error.message);
            }
        }
        
        // Generate roadmap
        function generateRoadmap() {
            try {
                const outputDiv = document.getElementById('output');
                const jsonInput = document.getElementById('jsonInput').value;
                
                if (!jsonInput.trim()) {
                    outputDiv.innerHTML = '<div class="error">Please enter JSON data first.</div>';
                    return;
                }
                
                const projects = JSON.parse(jsonInput);
                
                // Generate Gantt Chart
                let ganttChart = 'gantt\n';
                ganttChart += '    title Architecture Roadmap Timeline\n';
                ganttChart += '    dateFormat YYYY-MM-DD\n';
                ganttChart += '    axisFormat %b %Y\n\n';
                
                // Group projects by architect
                const architects = {};
                projects.forEach(project => {
                    const architect = project.architect || 'Unassigned';
                    if (!architects[architect]) {
                        architects[architect] = [];
                    }
                    architects[architect].push(project);
                });
                
                // Add to gantt chart
                for (const architect in architects) {
                    ganttChart += `    section ${architect}\n`;
                    
                    architects[architect].forEach(project => {
                        let status = 'active';
                        const statusLower = (project.status || '').toLowerCase();
                        
                        if (statusLower.includes('complete') || statusLower.includes('done')) {
                            status = 'done';
                        } else if (statusLower.includes('plan')) {
                            status = 'planned';
                        }
                        
                        ganttChart += `    ${project.project_name} :${status}, ${project.start_date}, ${project.end_date}\n`;
                    });
                }
                
                // Build output HTML
                let html = '<h2>Architecture Roadmap</h2>';
                html += '<div class="mermaid">\n' + ganttChart + '</div>';
                
                // Add project table
                html += '<h2>Project Details</h2>';
                html += '<table>';
                html += '<tr><th>Project</th><th>Architect</th><th>Type</th><th>Status</th><th>Start Date</th><th>End Date</th></tr>';
                
                projects.forEach(project => {
                    html += `<tr>
                        <td>${project.project_name || ''}</td>
                        <td>${project.architect || ''}</td>
                        <td>${project.type || ''}</td>
                        <td>${project.status || ''}</td>
                        <td>${project.start_date || ''}</td>
                        <td>${project.end_date || ''}</td>
                    </tr>`;
                });
                
                html += '</table>';
                
                // Update output
                outputDiv.innerHTML = html;
                
                // Render Mermaid diagrams
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
                
            } catch (error) {
                document.getElementById('output').innerHTML = 
                    `<div class="error">Error generating roadmap: ${error.message}</div>`;
                console.error('Error:', error);
            }
        }
        
        // Export as HTML
        function exportHtml() {
            try {
                const jsonInput = document.getElementById('jsonInput').value;
                if (!jsonInput.trim()) {
                    alert('Please generate a roadmap first.');
                    return;
                }
                
                const projects = JSON.parse(jsonInput);
                
                // Generate Gantt Chart
                let ganttChart = 'gantt\n';
                ganttChart += '    title Architecture Roadmap Timeline\n';
                ganttChart += '    dateFormat YYYY-MM-DD\n';
                ganttChart += '    axisFormat %b %Y\n\n';
                
                // Group projects by architect
                const architects = {};
                projects.forEach(project => {
                    const architect = project.architect || 'Unassigned';
                    if (!architects[architect]) {
                        architects[architect] = [];
                    }
                    architects[architect].push(project);
                });
                
                // Add to gantt chart
                for (const architect in architects) {
                    ganttChart += `    section ${architect}\n`;
                    
                    architects[architect].forEach(project => {
                        let status = 'active';
                        const statusLower = (project.status || '').toLowerCase();
                        
                        if (statusLower.includes('complete') || statusLower.includes('done')) {
                            status = 'done';
                        } else if (statusLower.includes('plan')) {
                            status = 'planned';
                        }
                        
                        ganttChart += `    ${project.project_name} :${status}, ${project.start_date}, ${project.end_date}\n`;
                    });
                }
                
                // Create HTML document
                const html = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Architecture Roadmap</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 8px; text-align: left; border: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Architecture Roadmap</h1>
    
    <h2>Roadmap Timeline</h2>
    <div class="mermaid">
${ganttChart}
    </div>
    
    <h2>Project Details</h2>
    <table>
        <tr>
            <th>Project</th>
            <th>Architect</th>
            <th>Type</th>
            <th>Status</th>
            <th>Start Date</th>
            <th>End Date</th>
        </tr>
        ${projects.map(project => `
        <tr>
            <td>${project.project_name || ''}</td>
            <td>${project.architect || ''}</td>
            <td>${project.type || ''}</td>
            <td>${project.status || ''}</td>
            <td>${project.start_date || ''}</td>
            <td>${project.end_date || ''}</td>
        </tr>`).join('')}
    </table>
    
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
</body>
</html>`;
                
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'architecture-roadmap.html';
                a.click();
                URL.revokeObjectURL(url);
                
            } catch (error) {
                alert('Error exporting HTML: ' + error.message);
            }
        }
        
        // Export for Confluence
        function exportConfluence() {
            try {
                const jsonInput = document.getElementById('jsonInput').value;
                if (!jsonInput.trim()) {
                    alert('Please generate a roadmap first.');
                    return;
                }
                
                const projects = JSON.parse(jsonInput);
                
                // Create Confluence Wiki Markup
                let confluence = 'h1. Architecture Roadmap\n\n';
                
                // Mermaid diagram
                confluence += 'h2. Roadmap Timeline\n\n';
                confluence += '{code:language=mermaid}\n';
                
                // Recreate the gantt chart
                confluence += 'gantt\n';
                confluence += '    title Architecture Roadmap Timeline\n';
                confluence += '    dateFormat YYYY-MM-DD\n';
                confluence += '    axisFormat %b %Y\n\n';
                
                // Group projects by architect
                const architects = {};
                projects.forEach(project => {
                    const architect = project.architect || 'Unassigned';
                    if (!architects[architect]) {
                        architects[architect] = [];
                    }
                    architects[architect].push(project);
                });
                
                // Add to gantt chart
                for (const architect in architects) {
                    confluence += `    section ${architect}\n`;
                    
                    architects[architect].forEach(project => {
                        let status = 'active';
                        const statusLower = (project.status || '').toLowerCase();
                        
                        if (statusLower.includes('complete') || statusLower.includes('done')) {
                            status = 'done';
                        } else if (statusLower.includes('plan')) {
                            status = 'planned';
                        }
                        
                        confluence += `    ${project.project_name} :${status}, ${project.start_date}, ${project.end_date}\n`;
                    });
                }
                
                confluence += '{code}\n\n';
                
                // Project details table
                confluence += 'h2. Project Details\n\n';
                confluence += '||Project||Architect||Type||Status||Start Date||End Date||\n';
                
                projects.forEach(project => {
                    confluence += `|${project.project_name || ''}|${project.architect || ''}|${project.type || ''}|${project.status || ''}|${project.start_date || ''}|${project.end_date || ''}|\n`;
                });
                
                const blob = new Blob([confluence], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'confluence-roadmap.txt';
                a.click();
                URL.revokeObjectURL(url);
                
                alert('Confluence markup created! To use in Confluence:\n1. Create or edit a page\n2. Click "Insert" > "Markup"\n3. Select "Confluence Wiki"\n4. Paste the contents of the downloaded file\n5. Click "Insert"');
                
            } catch (error) {
                alert('Error exporting for Confluence: ' + error.message);
            }
        }
        
        // Initialize with sample data
        loadSample();
    </script>
</body>
</html>
