<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Quarterly Roadmap</title>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            color: #333;
        }
        h1, h2 { 
            color: #333;
        }
        .export-btn { 
            padding: 8px 12px; 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 10px 5px 10px 0; 
        }
        .roadmap-container {
            width: 100%;
            overflow-x: auto;
            margin: 20px 0;
        }
        .quarterly-roadmap {
            display: grid;
            grid-template-columns: 200px repeat(4, 1fr);
            gap: 2px;
            width: 100%;
            max-width: 1100px;
        }
        .header {
            background-color: #333;
            color: white;
            padding: 10px;
            font-weight: bold;
            text-align: center;
        }
        .topic-cell {
            padding: 10px;
            background-color: #f5f5f5;
            font-weight: bold;
        }
        .quarter-cell {
            padding: 10px;
            text-align: center;
            font-size: 0.9em;
            min-height: 20px;
            position: relative;
        }
        .activity-container {
            position: absolute;
            top: 2px;
            bottom: 2px;
            left: 2px;
            right: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-weight: 500;
            z-index: 1;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .activity-left {
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            left: 2px;
            right: 0;
            padding-right: 0;
        }
        .activity-middle {
            border-radius: 0;
            left: 0;
            right: 0;
        }
        .activity-right {
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            right: 2px;
            left: 0;
            padding-left: 0;
        }
        .activity-single {
            border-radius: 6px;
        }
        .activity-continues-left::before {
            content: "◀";
            position: absolute;
            left: 6px;
            opacity: 0.7;
        }
        .activity-continues-right::after {
            content: "▶";
            position: absolute;
            right: 6px;
            opacity: 0.7;
        }
        /* Type-based color coding */
        .type-Product-Delivery {
            background-color: #4472C4;
            color: white;
        }
        .type-Tech-Debt {
            background-color: #ED7D31;
            color: white;
        }
        .type-Governance {
            background-color: #70AD47;
            color: white;
        }
        .type-Innovation {
            background-color: #7030A0;
            color: white;
        }
        .empty-cell {
            background-color: #f9f9f9;
        }
        .legend {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
        }
        .standalone-only {
            display: block;
        }
        /* For printing/export - keep intact */
        @media print {
            body {
                margin: 0;
                padding: 0;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="standalone-only no-print">
        <h1>Architecture Quarterly Roadmap - 2025</h1>
        
        <div>
            <button class="export-btn no-print" onclick="exportToPNG()">Export as PNG</button>
            <button class="export-btn no-print" onclick="window.location.href='index.html'">Back to Main View</button>
        </div>
    </div>
    
    <div id="roadmap-capture">
        <h2>2025 Quarterly Roadmap</h2>
        
        <div class="roadmap-container">
            <div class="quarterly-roadmap" id="quarterly-roadmap">
                <!-- Roadmap content will be inserted here -->
            </div>
        </div>
        
        <div class="legend" id="legend">
            <!-- Legend will be inserted here -->
        </div>
    </div>

    <script>
        // Check if this page is being embedded
        const urlParams = new URLSearchParams(window.location.search);
        const isEmbedded = urlParams.get('embedded') === 'true';
        
        // Show standalone elements if not embedded
        if (!isEmbedded) {
            document.querySelectorAll('.standalone-only').forEach(el => {
                el.style.display = 'block';
            });
        }
        
        // Define the quarters and types (for color coding)
        const quarters = ['Q1-2025', 'Q2-2025', 'Q3-2025', 'Q4-2025'];
        const types = {
            'Product Delivery': '#4472C4',
            'Tech Debt': '#ED7D31',
            'Governance': '#70AD47',
            'Innovation': '#7030A0'
        };
        
        // Render the quarterly roadmap
        function renderRoadmap(data) {
            const roadmapEl = document.getElementById('quarterly-roadmap');
            
            // Clear existing content
            roadmapEl.innerHTML = '';
            
            // Add headers
            roadmapEl.innerHTML += `<div class="topic-cell header">Initiative</div>`;
            quarters.forEach(quarter => {
                roadmapEl.innerHTML += `<div class="header">${quarter}</div>`;
            });
            
            // Group data by type
            const groupedData = {};
            data.forEach(item => {
                if (!groupedData[item.type]) {
                    groupedData[item.type] = [];
                }
                groupedData[item.type].push(item);
            });
            
            // Process each type
            Object.keys(groupedData).sort().forEach(type => {
                // Add items for this type
                groupedData[type].forEach(item => {
                    // Add the topic name
                    roadmapEl.innerHTML += `<div class="topic-cell">${item.topic}</div>`;
                    
                    // Create continuous activity boxes
                    const activitySpans = [];
                    let inActivity = false;
                    let activityStart = -1;
                    
                    // First determine the spans
                    quarters.forEach((quarter, index) => {
                        if (item.quarters.includes(quarter)) {
                            if (!inActivity) {
                                inActivity = true;
                                activityStart = index;
                            }
                        } else {
                            if (inActivity) {
                                inActivity = false;
                                activitySpans.push({
                                    start: activityStart,
                                    end: index - 1,
                                    type: type.replace(/\s+/g, '-')
                                });
                            }
                        }
                    });
                    
                    // If still in activity at the end, close it
                    if (inActivity) {
                        activitySpans.push({
                            start: activityStart,
                            end: quarters.length - 1,
                            type: type.replace(/\s+/g, '-')
                        });
                    }
                    
                    // Add quarters cells
                    quarters.forEach((quarter, index) => {
                        roadmapEl.innerHTML += `<div class="quarter-cell empty-cell" id="cell-${item.topic.replace(/[^a-zA-Z0-9]/g, '-')}-${index}"></div>`;
                    });
                    
                    // Add activity spans
                    activitySpans.forEach(span => {
                        const spanLength = span.end - span.start + 1;
                        let positionClass = '';
                        
                        if (spanLength === 1) {
                            positionClass = 'activity-single';
                        } else {
                            for (let i = span.start; i <= span.end; i++) {
                                if (i === span.start) {
                                    positionClass = 'activity-left';
                                } else if (i === span.end) {
                                    positionClass = 'activity-right';
                                } else {
                                    positionClass = 'activity-middle';
                                }
                                
                                const cell = document.getElementById(`cell-${item.topic.replace(/[^a-zA-Z0-9]/g, '-')}-${i}`);
                                
                                // Check if activity continues before or after the visible quarters
                                let continuesClass = '';
                                if (i === span.start && item.startsBeforeQ1) {
                                    continuesClass += ' activity-continues-left';
                                }
                                if (i === span.end && item.continuesBeyondQ4) {
                                    continuesClass += ' activity-continues-right';
                                }
                                
                                const activityText = (spanLength === 1 || i === Math.floor((span.start + span.end) / 2)) ? item.topic : '';
                                
                                cell.innerHTML = `<div class="activity-container ${positionClass} type-${span.type}${continuesClass}">${activityText}</div>`;
                            }
                        }
                    });
                });
            });
            
            // Render the legend
            renderLegend();
        }
        
        // Render the legend for color coding
        function renderLegend() {
            const legendEl = document.getElementById('legend');
            legendEl.innerHTML = '';
            
            Object.entries(types).forEach(([type, color]) => {
                legendEl.innerHTML += `
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: ${color};"></div>
                        <span>${type}</span>
                    </div>
                `;
            });
        }

        // Export roadmap to PNG for PowerPoint
        function exportToPNG() {
            const element = document.getElementById('roadmap-capture');
            
            html2canvas(element, {
                scale: 2, // Higher resolution
                backgroundColor: '#fff',
                logging: false
            }).then(canvas => {
                // Create a temporary link to download the image
                const link = document.createElement('a');
                link.download = 'quarterly_roadmap.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        // Load the roadmap data and render
        async function loadRoadmap() {
            try {
                const response = await fetch('quarterly-roadmap-data.json');
                if (!response.ok) {
                    throw new Error('Failed to load roadmap data');
                }
                
                const data = await response.json();
                renderRoadmap(data);
                
            } catch (error) {
                console.error('Error loading roadmap data:', error);
                document.getElementById('quarterly-roadmap').innerHTML = 
                    `<div style="color: red; grid-column: span 5;">Error loading roadmap data: ${error.message}</div>`;
            }
        }

        // Initialize when the document is ready
        document.addEventListener('DOMContentLoaded', loadRoadmap);
    </script>
</body>
</html>
