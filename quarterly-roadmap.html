<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Quarterly Roadmap</title>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            color: #333;
            background-color: #f8f8f8;
        }
        h1, h2 { 
            color: #333;
        }
        .export-btn { 
            padding: 8px 16px; 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 10px 5px 10px 0; 
            font-weight: bold;
        }
        .back-btn {
            padding: 8px 16px;
            background-color: #607D8B;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px 10px 0;
            font-weight: bold;
        }
        .roadmap-container {
            width: 100%;
            max-width: 1200px;
            margin: 20px auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            overflow: hidden;
        }
        .timeline-container {
            display: grid;
            grid-template-columns: 200px 1fr;
            width: 100%;
        }
        .quarter-markers {
            grid-column: 2;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            width: 100%;
            position: relative;
        }
        .quarter-marker {
            position: relative;
            text-align: center;
            font-weight: bold;
            background-color: #333;
            color: white;
            padding: 10px 0;
            border-radius: 4px 4px 0 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .month-markers {
            grid-column: 2;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            width: 100%;
            height: 20px;
            position: relative;
        }
        .month-marker {
            font-size: 9px;
            color: #777;
            text-align: center;
            padding-top: 5px;
            border-right: 1px dotted #eee;
        }
        .month-marker:last-child {
            border-right: none;
        }
        .activity-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            margin-bottom: 8px;
            height: 40px;
            position: relative;
        }
        .activity-label {
            padding: 10px;
            font-weight: bold;
            background-color: #f5f5f5;
            margin-bottom: 5px;
            border-radius: 4px;
            position: relative;
            z-index: 2;
        }
        .activity-timeline {
            position: relative;
            height: 40px;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
        }
        .activity-bar {
            position: absolute;
            height: 32px;
            top: 4px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            padding: 0 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            z-index: 2;
        }
        .activity-bar.continues-left:before {
            content: "◀";
            position: absolute;
            left: 8px;
            opacity: 0.7;
        }
        .activity-bar.continues-right:after {
            content: "▶";
            position: absolute;
            right: 8px;
            opacity: 0.7;
        }
        
        /* Type-based color coding */
        .type-Product-Delivery {
            background-color: #4472C4;
        }
        .type-Tech-Debt {
            background-color: #ED7D31;
        }
        .type-Governance-Innovation {
            background-color: #70AD47;
        }
        
        .legend {
            margin-top: 30px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            padding: 10px;
            border-top: 1px solid #eee;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        /* For printing/export - keep intact */
        @media print {
            body {
                margin: 0;
                padding: 0;
                background-color: white;
            }
            .no-print {
                display: none;
            }
            .roadmap-container {
                box-shadow: none;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="no-print">
        <button class="export-btn" onclick="exportToPNG()">Export as PNG</button>
        <button class="back-btn" onclick="window.location.href='index.html'">Back to Main View</button>
    </div>
    
    <div class="roadmap-container" id="roadmap-capture">
        <h2>2025 Quarterly Roadmap</h2>
        
        <div class="timeline-container">
            <div></div> <!-- Empty cell -->
            
            <div class="quarter-markers">
                <div class="quarter-marker">Q1-2025</div>
                <div class="quarter-marker">Q2-2025</div>
                <div class="quarter-marker">Q3-2025</div>
                <div class="quarter-marker">Q4-2025</div>
            </div>
            
            <div></div> <!-- Empty cell -->
            
            <div class="month-markers">
                <div class="month-marker">Jan</div>
                <div class="month-marker">Feb</div>
                <div class="month-marker">Mar</div>
                <div class="month-marker">Apr</div>
                <div class="month-marker">May</div>
                <div class="month-marker">Jun</div>
                <div class="month-marker">Jul</div>
                <div class="month-marker">Aug</div>
                <div class="month-marker">Sep</div>
                <div class="month-marker">Oct</div>
                <div class="month-marker">Nov</div>
                <div class="month-marker">Dec</div>
            </div>
        </div>
        
        <div id="activities-container">
            <!-- Activity rows will be inserted here -->
        </div>
        
        <div class="legend" id="legend">
            <!-- Legend will be inserted here -->
        </div>
    </div>

    <script>
        // Define the months to position calculation
        const monthPositions = {
            'Jan': 0,
            'Feb': 1,
            'Mar': 2,
            'Apr': 3,
            'May': 4,
            'Jun': 5,
            'Jul': 6,
            'Aug': 7,
            'Sep': 8,
            'Oct': 9,
            'Nov': 10,
            'Dec': 11
        };
        
        // Define the types (for color coding)
        const types = {
            'Product Delivery': '#4472C4',
            'Tech Debt': '#ED7D31',
            'Governance & Innovation': '#70AD47'
        };
        
        // Calculate position based on month and year
        function getMonthPosition(timeInfo) {
            // Default to the middle of the specified quarter if no specific month
            if (timeInfo.startsWith('Q1')) return 1;
            if (timeInfo.startsWith('Q2')) return 4;
            if (timeInfo.startsWith('Q3')) return 7;
            if (timeInfo.startsWith('Q4')) return 10;
            if (timeInfo === 'before Q1') return -1;
            if (timeInfo === 'after Q4') return 12;
            
            // Parse time info (format: "Month" or "early/mid/late Month")
            let month, modifier = null;
            
            if (timeInfo.includes('early')) {
                modifier = 'early';
                month = timeInfo.replace('early ', '');
            } else if (timeInfo.includes('mid')) {
                modifier = 'mid';
                month = timeInfo.replace('mid ', '');
            } else if (timeInfo.includes('late')) {
                modifier = 'late';
                month = timeInfo.replace('late ', '');
            } else {
                month = timeInfo;
            }
            
            if (!monthPositions.hasOwnProperty(month)) {
                console.error(`Unknown month: ${month}`);
                return 0;
            }
            
            let position = monthPositions[month];
            
            // Adjust for early/mid/late
            if (modifier === 'early') {
                position += 0.25;
            } else if (modifier === 'mid') {
                position += 0.5;
            } else if (modifier === 'late') {
                position += 0.75;
            }
            
            return position;
        }
        
        // Render the activities
        function renderActivities(data) {
            const containerEl = document.getElementById('activities-container');
            containerEl.innerHTML = '';
            
            // Process each activity
            data.forEach((item, index) => {
                const activityRow = document.createElement('div');
                activityRow.className = 'activity-row';
                
                // Add the label cell
                const labelCell = document.createElement('div');
                labelCell.className = 'activity-label';
                labelCell.textContent = item.topic;
                activityRow.appendChild(labelCell);
                
                // Add the timeline
                const timeline = document.createElement('div');
                timeline.className = 'activity-timeline';
                activityRow.appendChild(timeline);
                
                // Calculate position and width
                let startPos = 0;
                let endPos = 11;
                
                // If specific timing is provided
                if (item.startMonth) {
                    startPos = getMonthPosition(item.startMonth);
                } else if (item.quarters && item.quarters.length > 0) {
                    // Default to quarter start
                    const firstQuarter = item.quarters[0];
                    if (firstQuarter === 'Q1-2025') startPos = 0;
                    if (firstQuarter === 'Q2-2025') startPos = 3;
                    if (firstQuarter === 'Q3-2025') startPos = 6;
                    if (firstQuarter === 'Q4-2025') startPos = 9;
                }
                
                if (item.endMonth) {
                    endPos = getMonthPosition(item.endMonth);
                } else if (item.quarters && item.quarters.length > 0) {
                    // Default to quarter end
                    const lastQuarter = item.quarters[item.quarters.length - 1];
                    if (lastQuarter === 'Q1-2025') endPos = 2;
                    if (lastQuarter === 'Q2-2025') endPos = 5;
                    if (lastQuarter === 'Q3-2025') endPos = 8;
                    if (lastQuarter === 'Q4-2025') endPos = 11;
                }
                
                // Create activity bar
                const typeClass = `type-${item.type.replace(/\s+/g, '-')}`;
                const activityBar = document.createElement('div');
                activityBar.className = `activity-bar ${typeClass}`;
                
                // Check if continues beyond visible area
                if (item.startsBeforeQ1 || startPos < 0) {
                    activityBar.classList.add('continues-left');
                    startPos = Math.max(0, startPos);
                }
                if (item.continuesBeyondQ4 || endPos > 11) {
                    activityBar.classList.add('continues-right');
                    endPos = Math.min(11, endPos);
                }
                
                // Position and size
                const totalMonths = 12;
                const leftPercent = (startPos / totalMonths) * 100;
                const widthPercent = ((endPos - startPos + 1) / totalMonths) * 100;
                
                activityBar.style.left = `${leftPercent}%`;
                activityBar.style.width = `${widthPercent}%`;
                activityBar.textContent = item.topic;
                
                timeline.appendChild(activityBar);
                containerEl.appendChild(activityRow);
            });
            
            // Render the legend
            renderLegend();
        }
        
        // Render the legend for color coding
        function renderLegend() {
            const legendEl = document.getElementById('legend');
            legendEl.innerHTML = '';
            
            Object.entries(types).forEach(([type, color]) => {
                legendEl.innerHTML += `
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: ${color};"></div>
                        <span>${type}</span>
                    </div>
                `;
            });
        }

        // Export roadmap to PNG for PowerPoint
        function exportToPNG() {
            const element = document.getElementById('roadmap-capture');
            
            html2canvas(element, {
                scale: 2, // Higher resolution
                backgroundColor: '#fff',
                logging: false
            }).then(canvas => {
                // Create a temporary link to download the image
                const link = document.createElement('a');
                link.download = 'quarterly_roadmap.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        // Load the roadmap data and render
        async function loadRoadmap() {
            try {
                const response = await fetch('quarterly-roadmap-data.json');
                if (!response.ok) {
                    throw new Error('Failed to load roadmap data');
                }
                
                const data = await response.json();
                renderActivities(data);
                
            } catch (error) {
                console.error('Error loading roadmap data:', error);
                document.getElementById('activities-container').innerHTML = 
                    `<div style="color: red; padding: 20px;">Error loading roadmap data: ${error.message}</div>`;
            }
        }

        // Initialize when the document is ready
        document.addEventListener('DOMContentLoaded', loadRoadmap);
    </script>
</body>
</html>
