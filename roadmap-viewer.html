<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Team Roadmap</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.4.3/mermaid.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; }
        pre { background-color: #f5f5f5; padding: 15px; border-radius: 5px; overflow: auto; }
        button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; 
                cursor: pointer; margin: 10px 5px; border-radius: 4px; }
        .tabs { display: flex; border-bottom: 1px solid #ccc; margin-bottom: 20px; }
        .tab { padding: 10px 15px; cursor: pointer; background: #f1f1f1; margin-right: 5px; border-radius: 5px 5px 0 0; }
        .tab.active { background: #fff; border: 1px solid #ccc; border-bottom: 1px solid #fff; margin-bottom: -1px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        #output { margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 8px; text-align: left; border: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        .status-complete { background-color: #d4edda; }
        .status-progress { background-color: #fff3cd; }
        .status-planned { background-color: #d1ecf1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Architecture Team Roadmap</h1>
        
        <div class="tabs">
            <div class="tab active" data-tab="edit">Edit Data</div>
            <div class="tab" data-tab="view">View Roadmap</div>
        </div>
        
        <div id="edit-tab" class="tab-content active">
            <h2>Roadmap Data</h2>
            <p>
                <button id="loadFromGithub">Load from GitHub</button>
                <button onclick="generateRoadmap()">Generate Roadmap</button>
            </p>
            <textarea id="jsonInput" rows="15" cols="80"></textarea><br>
            <p>
                <button id="saveToLocal">Save to Local Storage</button>
                <button id="downloadJson">Download JSON</button>
            </p>
        </div>
        
        <div id="view-tab" class="tab-content">
            <div id="output"></div>
            <p>
                <button id="exportHtml">Export as HTML</button>
                <button id="exportMarkdown">Export as Markdown</button>
                <button id="exportConfluence">Export for Confluence</button>
            </p>
        </div>
    </div>

    <script>
        // Initialize tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to current tab
                tab.classList.add('active');
                document.getElementById(tab.getAttribute('data-tab') + '-tab').classList.add('active');
                
                // If viewing the roadmap tab, generate the roadmap
                if (tab.getAttribute('data-tab') === 'view') {
                    generateRoadmap();
                }
            });
        });
        
        // Initialize Mermaid
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({ startOnLoad: true });
            
            // Load data from localStorage if available
            const savedData = localStorage.getItem('roadmapData');
            if (savedData) {
                document.getElementById('jsonInput').value = savedData;
            }
            
            // Hook up the GitHub load button
            document.getElementById('loadFromGithub').addEventListener('click', loadFromGithub);
            
            // Hook up the save to localStorage button
            document.getElementById('saveToLocal').addEventListener('click', () => {
                localStorage.setItem('roadmapData', document.getElementById('jsonInput').value);
                alert('Data saved to browser storage');
            });
            
            // Hook up the download JSON button
            document.getElementById('downloadJson').addEventListener('click', downloadJson);
            
            // Hook up export buttons
            document.getElementById('exportHtml').addEventListener('click', exportHtml);
            document.getElementById('exportMarkdown').addEventListener('click', exportMarkdown);
            document.getElementById('exportConfluence').addEventListener('click', exportConfluence);
        });
        
        // Load data from GitHub
        function loadFromGithub() {
            fetch('roadmap-data.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load data. Status: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById('jsonInput').value = JSON.stringify(data, null, 2);
                    alert('Data loaded from GitHub successfully');
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    alert('Error loading data: ' + error.message);
                });
        }
        
        // Download JSON data
        function downloadJson() {
            const jsonData = document.getElementById('jsonInput').value;
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'roadmap-data.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Generate roadmap from JSON data
        function generateRoadmap() {
            try {
                // Get the input JSON
                const jsonInput = document.getElementById('jsonInput').value;
                const projects = JSON.parse(jsonInput);
                
                // Create the Mermaid Gantt chart
                let ganttChart = 'gantt\n';
                ganttChart += '    title Architecture Roadmap Timeline\n';
                ganttChart += '    dateFormat YYYY-MM-DD\n';
                ganttChart += '    axisFormat %b %Y\n\n';
                
                // Group projects by architect
                const architectProjects = {};
                
                projects.forEach(project => {
                    const architect = project.architect || 'Unassigned';
                    
                    if (!architectProjects[architect]) {
                        architectProjects[architect] = [];
                    }
                    
                    architectProjects[architect].push(project);
                });
                
                // Add projects to gantt chart grouped by architect
                for (const architect in architectProjects) {
                    ganttChart += `    section ${architect}\n`;
                    
                    architectProjects[architect].forEach(project => {
                        // Map status to Mermaid status
                        let status = 'active';
                        const statusLower = (project.status || '').toLowerCase();
                        if (statusLower.includes('complete') || statusLower.includes('done')) {
                            status = 'done';
                        } else if (statusLower.includes('plan')) {
                            status = 'planned';
                        }
                        
                        ganttChart += `    ${project.project_name} :${status}, ${project.start_date}, ${project.end_date}\n`;
                    });
                }
                
                // Create the HTML output
                let outputHtml = '<h2>Architecture Roadmap</h2>';
                outputHtml += '<div class="mermaid">\n' + ganttChart + '</div>';
                
                // Add project table
                outputHtml += '<h2>Project Details</h2>';
                outputHtml += '<table>';
                outputHtml += '<tr><th>Project</th><th>Architect</th><th>Type</th><th>Status</th><th>Start Date</th><th>End Date</th></tr>';
                
                projects.forEach(project => {
                    const statusLower = (project.status || '').toLowerCase();
                    let statusClass = 'status-progress';
                    
                    if (statusLower.includes('complete') || statusLower.includes('done')) {
                        statusClass = 'status-complete';
                    } else if (statusLower.includes('plan')) {
                        statusClass = 'status-planned';
                    }
                    
                    outputHtml += `<tr class="${statusClass}">
                        <td>${project.project_name}</td>
                        <td>${project.architect || 'Unassigned'}</td>
                        <td>${project.type || 'N/A'}</td>
                        <td>${project.status || 'N/A'}</td>
                        <td>${formatDate(project.start_date)}</td>
                        <td>${formatDate(project.end_date)}</td>
                    </tr>`;
                });
                
                outputHtml += '</table>';
                
                // Update the output
                document.getElementById('output').innerHTML = outputHtml;
                
                // Re-render Mermaid diagrams
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
                
            } catch (error) {
                document.getElementById('output').innerHTML = `<div style="color: red;">Error: ${error.message}</div>`;
                console.error('Error:', error);
            }
        }
        
        // Format date from YYYY-MM-DD to more readable format
        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
            } catch (e) {
                return dateStr; // Return original if parsing fails
            }
        }
        
        // Export as HTML file
        function exportHtml() {
            try {
                const ganttHtml = document.querySelector('.mermaid').outerHTML;
                const tableHtml = document.querySelector('table').outerHTML;
                
                const htmlContent = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Architecture Roadmap</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 8px; text-align: left; border: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        .status-complete { background-color: #d4edda; }
        .status-progress { background-color: #fff3cd; }
        .status-planned { background-color: #d1ecf1; }
    </style>
</head>
<body>
    <h1>Architecture Roadmap</h1>
    ${ganttHtml}
    <h2>Project Details</h2>
    ${tableHtml}
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
</body>
</html>`;
                
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'architecture-roadmap.html';
                a.click();
                URL.revokeObjectURL(url);
                
            } catch (error) {
                alert('Error exporting HTML: ' + error.message);
            }
        }
        
        // Export as Markdown
        function exportMarkdown() {
            try {
                const projects = JSON.parse(document.getElementById('jsonInput').value);
                
                // Start building markdown
                let markdown = '# Architecture Roadmap\n\n';
                
                // Gantt Chart
                markdown += '## Roadmap Timeline\n\n';
                markdown += '```mermaid\n';
                
                // Recreate the gantt chart
                markdown += 'gantt\n';
                markdown += '    title Architecture Roadmap Timeline\n';
                markdown += '    dateFormat YYYY-MM-DD\n';
                markdown += '    axisFormat %b %Y\n\n';
                
                // Group projects by architect
                const architectProjects = {};
                
                projects.forEach(project => {
                    const architect = project.architect || 'Unassigned';
                    
                    if (!architectProjects[architect]) {
                        architectProjects[architect] = [];
                    }
                    
                    architectProjects[architect].push(project);
                });
                
                // Add projects to gantt chart
                for (const architect in architectProjects) {
                    markdown += `    section ${architect}\n`;
                    
                    architectProjects[architect].forEach(project => {
                        // Map status to Mermaid status
                        let status = 'active';
                        const statusLower = (project.status || '').toLowerCase();
                        if (statusLower.includes('complete') || statusLower.includes('done')) {
                            status = 'done';
                        } else if (statusLower.includes('plan')) {
                            status = 'planned';
                        }
                        
                        markdown += `    ${project.project_name} :${status}, ${project.start_date}, ${project.end_date}\n`;
                    });
                }
                
                markdown += '```\n\n';
                
                // Project details table
                markdown += '## Project Details\n\n';
                markdown += '| Project | Architect | Type | Status | Start Date | End Date |\n';
                markdown += '| ------- | --------- | ---- | ------ | ---------- | -------- |\n';
                
                projects.forEach(project => {
                    markdown += `| ${project.project_name} | ${project.architect || 'Unassigned'} | ${project.type || 'N/A'} | ${project.status || 'N/A'} | ${project.start_date} | ${project.end_date} |\n`;
                });
                
                // Create download
                const blob = new Blob([markdown], { type: 'text/markdown' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'architecture-roadmap.md';
                a.click();
                URL.revokeObjectURL(url);
                
            } catch (error) {
                alert('Error exporting Markdown: ' + error.message);
            }
        }
        
        // Export for Confluence
        function exportConfluence() {
            try {
                const projects = JSON.parse(document.getElementById('jsonInput').value);
                
                // Create Confluence Wiki Markup
                let confluence = 'h1. Architecture Roadmap\n\n';
                
                // Mermaid diagram
                confluence += 'h2. Roadmap Timeline\n\n';
                confluence += '{code:language=mermaid}\n';
                
                // Recreate the gantt chart
                confluence += 'gantt\n';
                confluence += '    title Architecture Roadmap Timeline\n';
                confluence += '    dateFormat YYYY-MM-DD\n';
                confluence += '    axisFormat %b %Y\n\n';
                
                // Group projects by architect
                const architectProjects = {};
                
                projects.forEach(project => {
                    const architect = project.architect || 'Unassigned';
                    
                    if (!architectProjects[architect]) {
                        architectProjects[architect] = [];
                    }
                    
                    architectProjects[architect].push(project);
                });
                
                // Add projects to gantt chart
                for (const architect in architectProjects) {
                    confluence += `    section ${architect}\n`;
                    
                    architectProjects[architect].forEach(project => {
                        // Map status to Mermaid status
                        let status = 'active';
                        const statusLower = (project.status || '').toLowerCase();
                        if (statusLower.includes('complete') || statusLower.includes('done')) {
                            status = 'done';
                        } else if (statusLower.includes('plan')) {
                            status = 'planned';
                        }
                        
                        confluence += `    ${project.project_name} :${status}, ${project.start_date}, ${project.end_date}\n`;
                    });
                }
                
                confluence += '{code}\n\n';
                
                // Project details table
                confluence += 'h2. Project Details\n\n';
                confluence += '||Project||Architect||Type||Status||Start Date||End Date||\n';
                
                projects.forEach(project => {
                    confluence += `|${project.project_name}|${project.architect || 'Unassigned'}|${project.type || 'N/A'}|${project.status || 'N/A'}|${project.start_date}|${project.end_date}|\n`;
                });
                
                // Create download
                const blob = new Blob([confluence], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'confluence-roadmap.txt';
                a.click();
                URL.revokeObjectURL(url);
                
                // Show instructions for Confluence
                alert('Confluence markup exported. To use in Confluence:\n\n1. Create or edit a Confluence page\n2. Click "Insert" > "Markup"\n3. Choose "Confluence Wiki" format\n4. Paste the contents of the downloaded file\n5. Click "Insert"');
                
            } catch (error) {
                alert('Error exporting for Confluence: ' + error.message);
            }
        }
    </script>
</body>
</html>
